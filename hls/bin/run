#!/usr/bin/python3

from pathlib import Path
import docker
import os

IMAGE_TAG = 'alfg/nginx-rtmp'
CONTAINER_NAME = 'hls-rtmp'

script_full_path = os.path.realpath(__file__)
project_root = Path(script_full_path).parent.parent.parent
videoroom_dir = project_root.joinpath(Path('videoroom'))
nginx_serve_dir = '/usr/local/nginx/html'

client = docker.from_env()

try:
    running_container = client.containers.get(CONTAINER_NAME)
    running_container.stop()
except Exception:
    pass

client.containers.run(
    IMAGE_TAG,
    name=CONTAINER_NAME,
    auto_remove=True,
    detach=True,
    ports={
        '1935/tcp': '1935',
        '80/tcp': '8080',
    },
    volumes={
        videoroom_dir: {
            'bind': nginx_serve_dir,
            'mode': 'rw',
        }
    },
)
